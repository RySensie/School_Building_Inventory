{{> schoolAd-sidenav building=true}}
<div class="main-content" id="panel">
    {{> schoolAd-topnav building=true}}
    <!-- Header -->
    <div class="header bg-primary pb-6">
        <div class="container-fluid">
            <div class="header-body">
                <div class="row align-items-center py-4">
                    <div class="col-lg-6 col-7">
                        <nav aria-label="breadcrumb" class="d-none d-md-inline-block ml-md-4">
                            <ol class="breadcrumb breadcrumb-links breadcrumb-dark">
                                <li class="breadcrumb-item"><a href="/schoolAd/dashboard"><i class="fas fa-home">
                                            Dashboard</i></a></li>
                                <li class="breadcrumb-item"><a href="/schoolAd/building"> Building List</a></li>
                                <li class="breadcrumb-item active" aria-current="page"> Building Details</li>
                            </ol>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Page content -->
    <div class="container-fluid mt--6">
        <div class="row">
            <div class="col">
                <div class="card">
                    <div class="card-header">
                        {{#if message }}
                        <div class="alert alert-{{alert}}" role="alert">
                            <strong>Alert!</strong> {{message}}
                        </div>
                        {{/if}}
                        <div class="row align-items-center">
                            <div class="col text-right">
                                <button class="btn btn-sm btn-primary updateC" data-id="{{building._id}}"
                                    data-actual_img="{{building.actual_img}}" data-percentage="{{building.percentage}}"
                                    data-buildingCondition="{{building.buildingCondition}}"> Update Condition</button>
                                <a href="/schoolAd/room/{{building_id}}" class="btn btn-sm btn-warning">Room Details</a>
                                <a href="/schoolAd/building/buildingWSF/{{building_id}}"
                                    class="btn btn-sm btn-info">Water & Sanitation</a>
                            </div>
                        </div>
                    </div>
                    <form>
                        <fieldset disabled>
                            <div class="card-body">
                                <div class="pl-lg-4">
                                    <div class="row">
                                        <div class="col-lg-6 mb-4">
                                            <div id="carouselExampleIndicators" class="carousel slide col-lg-6"
                                                data-ride="carousel">
                                                <ol class="carousel-indicators">
                                                    <li data-target="#carouselExampleIndicators" data-slide-to="0"
                                                        class="active"></li>
                                                    <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                                                    <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
                                                </ol>
                                                <div class="carousel-inner">
                                                    <div class="carousel-item active">
                                                        <img class="d-block w-100 rounded-lg"
                                                            src="{{building.actual_img}}" alt="First slide">
                                                    </div>
                                                    <div class="carousel-item">
                                                        <img class="d-block w-100 rounded-lg"
                                                            src="{{building.blueprint_img}}" alt="Second slide">
                                                    </div>
                                                    <div class="carousel-item">
                                                        <img class="d-block w-100 rounded-lg"
                                                            src="{{building.proof_img}}" alt="Third slide">
                                                    </div>
                                                </div>
                                                <a class="carousel-control-prev" href="#carouselExampleIndicators"
                                                    role="button" data-slide="prev">
                                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                                    <span class="sr-only">Previous</span>
                                                </a>
                                                <a class="carousel-control-next" href="#carouselExampleIndicators"
                                                    role="button" data-slide="next">
                                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                                    <span class="sr-only">Next</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="pl-lg-4">
                                    <div class="row">
                                        <div class="col-lg-5">
                                            <div class="form-group">
                                                <label class="form-control-label" for="building-number">Building
                                                    Number/Name</label>
                                                <input type="text" id="buildingNumber" class="form-control text-primary"
                                                    value="{{building.buildingNumber}}" />
                                            </div>
                                        </div>
                                        <div class="col-lg-5">
                                            <div class="form-group">
                                                <label class="form-control-label" for="building-number">Building
                                                    Type</label>
                                                <input type="text" id="buildingNumber" class="form-control text-primary"
                                                    value="{{building.buildingType}}" />
                                            </div>
                                        </div>
                                        <div class="col-lg-4">
                                            <div class="form-group">
                                                <label class="form-control-label">Fund Source</label>
                                                <input type="text" class="form-control text-primary"
                                                    value="{{building.specificFundSource}}" />
                                            </div>
                                        </div>
                                        <div class="col-lg-4">
                                            <div class="form-group">
                                                <label class="form-control-label">Specific Fund Source</label>
                                                <input type="text" class="form-control text-primary"
                                                    value="{{building.specificFundSource}}" />
                                            </div>
                                        </div>
                                        <div class="col-lg-4">
                                            <div class="form-group">
                                                <label class="form-control-label">Building Condition</label>
                                                <input type="text" class="form-control text-primary"
                                                    value="{{building.buildingCondition}}" />
                                            </div>
                                        </div>
                                        <div class="col-lg-4">
                                            <div class="form-group">
                                                <label class="form-control-label">Number of Storey</label>
                                                <input type="number" class="form-control text-primary"
                                                    value="{{building.numberOfStorey}}" />
                                            </div>
                                        </div>
                                        <div class="col-lg-3">
                                            <div class="form-group">
                                                <label class="form-control-label">Number of Rooms</label>
                                                <input type="number" class="form-control text-primary"
                                                    value="{{building.numberOfRooms}}" />
                                            </div>
                                        </div>
                                        <div class="col-lg-3">
                                            <div class="form-group">
                                                <label class="form-control-label">Classification of Building</label>
                                                <input type="text" class="form-control text-primary"
                                                    value="{{building.classificationOfBuilding}}" />
                                            </div>
                                        </div>
                                        <div class="col-lg-4">
                                            <div class="form-group">
                                                <label class="form-control-label">Year Completed</label>
                                                <input type="date" class="form-control text-primary"
                                                    value="{{building.yearCompleted}}" />
                                            </div>
                                        </div>
                                        <div class="col-lg-3">
                                            <div class="form-group">
                                                <label class="form-control-label">Date Acquisition</label>
                                                <input type="date" class="form-control text-primary"
                                                    value="{{building.dateAcquisition}}" />
                                            </div>
                                        </div>
                                        <div class="col-lg-3">
                                            <div class="form-group">
                                                <label class="form-control-label">Acquisition Cost </label>
                                                <input type="text" class="form-control text-primary"
                                                    value="{{building.acquisitionCost}}" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <hr class="my-4" />
                                <div class="pl-lg-4">
                                    <div class="row">
                                        <div class="col-lg-4">
                                            <div class="form-group">
                                                <label class="form-control-label">Building Materials</label>
                                                <input type="text" class="form-control text-primary"
                                                    value="{{building.buildingMaterial}}" />
                                            </div>
                                        </div>
                                        <div class="col-lg-4">
                                            <div class="form-group">
                                                <label class="form-control-label">Book Value</label>
                                                <input type="text" class="form-control text-primary"
                                                    value="{{building.bookValue}}" />
                                            </div>
                                        </div>
                                        <div class="col-lg-4">
                                            <div class="form-group">
                                                <label class="form-control-label">Insurance Information</label>
                                                <input type="text" class="form-control text-primary"
                                                    value="{{building.insuranceInfo}}" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <hr class="my-4" />
                                <div class="pl-lg-4">
                                    <div class="row">
                                        <div class="form-group col-lg-4">
                                            <label class="form-control-label">Building PWD Accessible?</label>
                                            <input type="text" class="form-control text-primary"
                                                value="{{building.pwdAccessible}}" />
                                        </div>
                                        <div class="form-group col-lg-4">
                                            <label class="form-control-label">Undergone Major Repair</label>
                                            <input type="text" class="form-control text-primary"
                                                value="{{building.undergoneMajorRepair}}" />
                                        </div>
                                        <div class="form-group col-lg-4">
                                            <label class="form-control-label">With Certificate of Acceptance?</label>
                                            <input type="text" class="form-control text-primary"
                                                value="{{building.certificateOfAcceptance}}" />
                                        </div>
                                        <div class="form-group col-lg-4">
                                            <label class="form-control-label">Building Include in the Boook of
                                                Accountant?</label>
                                            <input type="text" class="form-control text-primary"
                                                value="{{building.includeDepedBook}}" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- **************************** update condition Modal ****************************** -->
<div class="modal fade updateCondition" data-backdrop="static" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="card-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-xl-12">
                        <h2 class="text-center">BUILDING INFORMATION</h2>
                    </div>
                    <div class="col-xl-12 mt-5">
                        <div class="card">
                            <div class="card-header border-0">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <h3 class="text-center">ROOM WITH DAMAGES</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-bordered" id="tangene">
                                    <thead class="thead-light text-center">                                 
                                        <tr class="text-center">
                                            <th scope="col" lass="sort" data-sort="budget">Room Number</th>
                                            <th scope="col" class="sort" data-sort="budget">Room Condition</th>
                                            <th scope="col" class="sort" data-sort="status">Actual Usage</th>
                                            <th scope="col" class="sort" data-sort="status">Floor Number</th>
                                        </tr>
                                    </thead>
                                    <tbody class="list text-center">
                                        {{#each RoomDamage}}

                                        <tr class="text-center">
                                            <td scope="row">
                                                <div class="media align-items-center">
                                                    <a class="avatar rounded-circle mr-3">
                                                        <img alt="Image placeholder" src="{{this.actual_img}}">
                                                    </a>
                                                    <div class="media-body">
                                                        <a class="name mb-0 text-sm">{{this.roomNumber}}</a>
                                                    </div>
                                                </div>
                                            </td>
                                            <td scope="row">
                                                <div class="media-body">
                                                    <span class="name mb-0 text-sm">{{this.roomCondition}}</span>
                                                </div>
                                            </td>
                                            <td scope="row">
                                                <div class="media-body">
                                                    <span class="name mb-0 text-sm">{{this.actualUsage}}</span>
                                                </div>
                                            </td>
                                            <td scope="row">
                                                <div class="media-body">
                                                    <span class="name mb-0 text-sm">{{this.floor}}</span>
                                                </div>
                                            </td>
                                        </tr>
                                        {{/each}}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-12">
                        
                        <form>
                            <div class="row border border-dark">
                                <div class="col-sm-12 mb-4 mt-3">
                                    <h2 class="text-center">Building Structure Form <a tabindex="0" class="btn btn-sm" role="button" data-toggle="popover" data-trigger="focus" title=""
                                        data-placement="top" data-content="Check the box, if the building have this kind of damage. Click next button if its done. ">
                                        <span class="material-icons">
                                          help_outline
                                        </span>
                                      </a>
                                    </h2>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-check text-center">
                                        <input type="number" id="roomPer" value="{{perall}}" hidden>
                                        <input class="form-check-input prc" type="checkbox" value="ROOF" name="roof"
                                            id="roof">
                                        <label class="form-check-label" for="roof">
                                            ROOF
                                        </label>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-check">
                                        <input class="form-check-input prc" type="checkbox" value="FADED PAINT" name="paint"
                                            id="paint">
                                        <label class="form-check-label" for="defaultCheck1">
                                            FADED PAINT
                                        </label>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-check">
                                        <input class="form-check-input prc" type="checkbox" value="CEILING"
                                            name="ceiling" id="ceiling">
                                        <label class="form-check-label" for="defaultCheck1">
                                            CEILING
                                        </label>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-check text-center">
                                        <input class="form-check-input prc" type="checkbox" value="WALL" name="wall"
                                            id="wall">
                                        <label class="form-check-label" for="defaultCheck1">
                                            WALL
                                        </label>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-check">
                                        <input class="form-check-input prc" type="checkbox" value="CRACK" name="crack"
                                            id="crack">
                                        <label class="form-check-label" for="defaultCheck1">
                                            CRACK
                                        </label>
                                    </div>
                                </div>
                                <div class="col-sm-12 text-center mt-3 mb-2">
                                    <button type="button" class="btn btn-sm btn-primary"
                                        onclick="myFunction()">Next</button>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="col-xl-12 pt-5 mt-3">
                        <div class="col-sm-12 mb-2">
                            <h2 class="text-center">BUILDING CONDTION UPDATE</h2>
                        </div>
                        <form action="/schoolAd/building/conditionUpdate" method="POST" enctype="multipart/form-data">
                            <div class="pl-lg-4">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label" for="building-number">ACTUAL PHOTO</label>
                                            <a tabindex="0" class="btn btn-sm" role="button" data-toggle="popover"
                                                data-trigger="focus" title="" data-placement="top"
                                                data-content="Upload actual photo of the building.">
                                                <span class="material-icons">
                                                    help_outline
                                                </span></a>
                                            <img class="img-thumbnail" id="actual_img_edit" />
                                            <input id="upload4" name="actual_img" type="file" accept=".jpg,.jpeg"
                                                onchange="readURL3(this);" class="form-control border-0" />
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="form-group">
                                            <input type="text" name="edit_id" id="edit_id" class="form-control" hidden>
                                            <input type="text" name="roof" id="rf" class="form-control" hidden>
                                            <input type="text" name="paint" id="pt" class="form-control" hidden>
                                            <input type="text" name="ceiling" id="cl" class="form-control" hidden>
                                            <input type="text" name="wall" id="wl" class="form-control" hidden>
                                            <input type="text" name="crack" id="crk" class="form-control" hidden>
                                            <input type="text" id="recom" value="" class="form-control" name=""
                                                readonly />
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label" for="building-number">LEVEL OF DAMAGE</label>
                                            <a tabindex="0" class="btn btn-sm" role="button" data-toggle="popover"
                                                data-trigger="focus" title="" data-placement="top"
                                                data-content="Refers to the curret percentage of the buildings condition. To get the percentage,
                                                 please fill the ROOM CONDITION FORM  first and click next button. The calculation of the percentage was 
                                                 builing structure 60% and 40% or room condition">
                                                <span class="material-icons">
                                                    help_outline
                                                </span>
                                            </a>
                                            <input type="text" id="percentage" value="" class="form-control"
                                                name="percentage" />
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label" for="buildingCondition">BUILDING
                                                CONDITION</label>
                                            <a tabindex="0" class="btn btn-sm" role="button" data-toggle="popover"
                                                data-trigger="focus" title="" data-placement="top"
                                                data-content="Refers to the current physical state of a building.">
                                                <span class="material-icons">
                                                    help_outline
                                                </span>
                                            </a>
                                            <select id="buildingCondition_edit" name="buildingCondition"
                                                class="form-control">
                                                <option selected value="buildingCondition_edit"></option>
                                                <option>GOOD CONDITION</option>
                                                <option>MINOR DAMAGE</option>
                                                <option>MAJOR DAMAGE</option>
                                                <option>CONDEMNED/DEMOLATION</option>
                                                <option>COMPLETION</option>
                                                <option>ON GOING CONSTRUCTION</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="row align-items-center">
                                    <!-- <div class="col-8">
                                    </div> -->
                                    <div class="col-lg-12 text-center">
                                        <button id="btn-save" type="submit" class="btn btn-primary">
                                            UPDATE
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    function myFunction() {
        let Croof = $('#roof').is(':checked');
        if (Croof == true) {
            var roof = 10;
            var Roofs = document.getElementById("roof").value;
        }
        else {
            var roof = 0;
            var Roofs = "Unchecked";
        }
        var roofs = parseInt(roof);
        let Cpaint = $('#paint').is(':checked');
        if (Cpaint == true) {
            var paint = 10;
            var Paints = document.getElementById("paint").value;
        }
        else {
            var paint = 0;
            var Paints = "Unchecked";
        }
        var paints = parseInt(paint);
        let Cceiling = $('#ceiling').is(':checked');
        if (Cceiling == true) {
            var ceiling = 10;
            var Ceilings = document.getElementById("ceiling").value;
        }
        else {
            var ceiling = 0;
            var Ceilings = "Unchecked";
        }
        var ceilings = parseInt(ceiling);
        let Cwall = $('#wall').is(':checked');
        if (Cwall == true) {
            var wall = 10;
            var Walls = document.getElementById("wall").value;
        }
        else {
            var wall = 0;
            var Walls = "Unchecked";
        }
        var walls = parseInt(wall);
        let Ccrack = $('#crack').is(':checked');
        if (Ccrack == true) {
            var crack = 20;
            var Cracks = document.getElementById("crack").value;
        }
        else {
            var crack = 0;
            var Cracks = "Unchecked";
        }
        var cracks = parseInt(crack);
        var roomPer = document.getElementById("roomPer").value;
        var room = parseInt(roomPer);
        let total = roofs + paints + ceilings + walls + cracks;
        let percentage = total + room;

        if (percentage == 0) {
            var less = "The recommended building condition is Good Condition"
        }
        if (percentage > 0 && percentage <= 45) {
            var less = "The recommended building condition is Minor Damage"
        }
        if (percentage >45 && percentage <= 100) {
            var less = "The recommended building condition is Major Damage"
        }
        console.log(percentage);
        console.log(Roofs);

        $("#percentage").val(percentage);
        $("#recom").val(less);
        $("#rf").val(Roofs);
        $("#pt").val(Paints);
        $("#cl").val(Ceilings);
        $("#wl").val(Walls);
        $("#crk").val(Cracks);

    }
</script>
<!-- **************************** update codition script ****************************** -->
<script>
    $('.updateC').click(function () {
        $('#edit_id').val($(this).attr('data-id'));
        $("#actual_img_edit").attr("src", $(this).attr('data-actual_img'));
        $('#percentage').val($(this).attr('data-percentage'));
        $('#buildingCondition_edit').val($(this).attr('data-buildingCondition'));

        $('.updateCondition').modal('show');
    });
</script>
<!-- UPLAOD Image UPDATED ACTUAL PHOTO-->
<script>
    /*  ==========================================
      SHOW UPLOADED IMAGE
  * ========================================== */
    function readURL3(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $("#actual_img_edit").attr("src", e.target.result);
                $("#imgdatainput").val(e.target.result);
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    $(function () {
        $("#upload4").on("change", function () {
            readURL3(input);
        });
    });

    /*  ==========================================
      SHOW UPLOADED IMAGE NAME
  * ========================================== */
    var input = document.getElementById("upload4");
    var infoArea = document.getElementById("upload-label");

    input.addEventListener("change", showFileName);
    function showFileName(event) {
        var input = event.srcElement;
        var fileName = input.files[0].name;
        infoArea.textContent = "File name: " + fileName;
    }
</script>
<script>
    $(document).ready(function () {
      $('[data-toggle="popover"]').popover();
    });
</script>
    